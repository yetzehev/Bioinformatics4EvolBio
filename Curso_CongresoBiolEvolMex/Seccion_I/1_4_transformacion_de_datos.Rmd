---
title: "Transformación de datos"
author: "Daniela Felix"
output:
  html_document:
    toc: true
    toc_float: true
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
library(vcfR)
library(adegenet)
library(dartR)
library(tidyverse)
```

```{r}
# setwd("Bioinformatics4EvolBio/Bioinformatics4EvolBio/Curso_CongresoBiolEvolMex/")
```

El archivo es un VCF, por lo que tenemos que utilizar la función `read.vcfR` de la paquetería `vcfR`

```{r}
fish.vcf <- read.vcfR("../Seccion_II/datos/plectropomus_leopardus/radiator_data_20220330_1452.vcf")
```
Dado que nuestra base de datos se compone de solo 200 individuos, sin embargo, nuestro objeto VCF muestra que tenemos 209, esto significa que algunos de los ID de los indivuos se encuentran repetidos, antes de poder convertilos a un archivo `genind`, debemos filtrarlos:

```{r}
# Single pipe to fix IDs
fish.vcf@fix[,3] <- tibble(
  id = getID(fish.vcf),
  chrom = getCHROM(fish.vcf),
  pos = getPOS(fish.vcf)
) %>%
  mutate(
    row = row_number(),
    new_id = case_when(
      id == "." ~ paste0(chrom, ":", pos),
      TRUE ~ id
    )
  ) %>%
  group_by(new_id) %>%
  mutate(
    new_id = if(n() > 1) paste0(new_id, "_", row) else new_id
  ) %>%
  pull(new_id)
```

```{r, echo= TRUE}
fish.ind <- vcfR2genind(fish.vcf)
fish.ind
```

Si revisamos ahora nuestro objeto `genind`, cuántos individuos han quedado después del filtrado?


### Uso de paquetería dartR


```{r pressure, echo=FALSE, fig.cap="A caption", out.width = '100%'}
# knitr::include_graphics("../../../../images/dartR_logo.png")
```

La paquetería dartR permite la conversión de archivos en distintos formatos a partir de un archivo `genlight`


```{r}
fish.gl <- vcfR2genlight(fish.vcf)
fish.gl
```

```{r include=FALSE}
library(dartRverse)
library(dartR)
```

Para convertirlo en un archivo `bayescan`:
```{r}
# gl2bayescan(fish.gl, outfile = "../../../Seccion_III/out/out_formats/fish_bayescan.txt", verbose = NULL)
```

Para convertilo en un archivo `genepop`:
```{r}
gl2genepop(fish.gl, outfile = "fish_genepop.txt", outpath = tempdir(), verbose = NULL)
```


Para convertilo a formato `plink`:
```{r}
# gl2plink(fish.gl, outfile = "fish_plink")
```



