---
title: "Paquetería adegenet"
author: "Daniela Felix"
output:
  html_document:
    css: styles.css
    toc: true
    toc_float: true
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

La documentación para la paquetería puede consultarse [aquí](https://academic.oup.com/bioinformatics/article/24/11/1403/191127)

```{r include=FALSE}
library(adegenet)
library(ggplot2)
```

Vamos a seleccionar el folder donde tenemos guardados nuestros archivos
> Si trabajamos con distintos sets de datos de distintos proyectos, podemos crear un proyecto específico. Esto nos permitirá guardar nuestros avances, tener las librerías y carpetas cargadas sin necesidad de estar buscando cada archivo de R a la vez.

```{r}
# setwd("Curso_CongresoBiolEvolMex\Seccion_II\datos\plectropomus_leopardus")
```
<sub>Se recomienda evitar los espacios en los nombres de carpetas para evitar errores de carga.</sub>



Cargaremos nuestro objeto `genind` en esta sesión:
```{r}
fish.ind <- readRDS(file.path("../Seccion_II/outputs/", "fish.ind.rds"))
fish.ind
```


```{r}
pop_info <- readRDS(file.path("../Seccion_II/outputs", "pop_info.rds"))
pop_info
```


## Análisis de componentes principales (PCA) 

Para calcular los eigenvalues podemos utilizar nuestro objeto genlight previamente guardado en la Sección I del curso. Cómo lo cargarían ustedes?

```{r}
fish.gl <- readRDS(file.path("../Seccion_II/outputs", "fish.gl.rds"))
fish.gl
```

Eigenvalues: cuál es el porcentaje de varianza explicada por los datos
```{r}
fish.pca <- glPca(fish.gl, nf = 3)
```

```{r}
barplot(100*fish.pca$eig/sum(fish.pca$eig),
        col = heat.colors(50), main="PCA Eigenvalues")
title(ylab="Percent of variance\nexplained", line = 2)
title(xlab="Eigenvalues", line = 1)
```

```{r}
fish.pca
```

```{r}
fish.scores <- as.data.frame(fish.pca$scores)
fish.scores$pop <- pop(fish.gl)
```



```{r warning=FALSE}
set.seed(9)
fish_graph_pca <- ggplot(fish.scores, aes(x=PC1, y=PC2, colour=fish.scores$pop)) +
  geom_point(size=2) +
  stat_ellipse(level = 0.95, size = 1) +
  # scale_color_manual(values = cols) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = 0) +
  theme_bw()

fish_graph_pca
```

## Análisis discriminante de componentes principales (DAPC) en `adegenet`


```{r}
fish.dapc <- dapc(fish.ind, n.pca = 50, n.da = length(levels(pop(fish.ind))) - 1)
```

```{r}
scatter.dapc(fish.dapc)
```

Personalizando el gráfico:
```{r}
# Plot the discriminant space
scatter(
  fish.dapc,
  posi.da = "bottomright",
  bg = "white",
  pch = 19,
  cstar = 0,
  col = adegenet::funky(nPop(fish.ind))
)

```

```{r}
# Build a color vector of length equal to the number of groups
K <- ncol(fish.dapc$posterior)  # number of groups (columns in Q)
cols <- adegenet::funky(K)
```


```{r}
compoplot(fish.dapc,col = function(x) cols, posi = 'top')
```

```{r}
K <- ncol(fish.dapc$posterior)  # number of groups (columns in Q)
compoplot(fish.dapc, col = K, posi = 'top')
```


